# Пчелка Майя () / «Сам себе пасечник»
## Онлайн симулятор с элементами РПГ работы самозанятого, который моделирует развитие ульев на пасеке

### Интро
Работа пчеловода в основном начинается в марте месяце. И самое главное перед началом сезона, это **предсказать**, насколько продуктивным будет год, надо ли расширяться или наоборот, надо сокращать количество ульев. Сколько времени и сил потребует работа на пасеке. И самое наверное главное - это **угадать**, какой будет спрос. В зависимости от сочетания всех этих факторов надо решать вопрос о необходимости привлечения сторонних средств.

Наша программа в игровой форме помогает будущим или настоящим пчеловодам смоделировать развитие ульев в соответствии с реальными погодными условиями на основе биологии пчел. Предсказать спрос, и, соответственно прибыльность пасеки за определенный год в данной местности.

Задача игрока - сделать правильное решение в начале года на основании среднестатистических данных и затем в течение года попытаться улучшить эту модель, уже по реальным данным.  
**Возможные ошибки игрока**: неправильная работа на пасеке, как следствие гибель пчел или недобор меда; неправильная, несвоевременная закупка расходников. Разорение или кидалово со стороны блогеров, неточная оценка популярности СМИ, поломка сайта, нехватка меда и невозможность выполнить заказы и т.д.  
**Возможные выигрыши**: попадание в тренд на видеохостинге, заметка у топового бьюти или ЗОЖ блогера; популярная статья в СМИ (Yaplakal, Pikabu например) и пр.


В начале новой игры игрок выбирает место расположения пасеки и год моделирования. Программа на основании исторических метеорологических данных моделирует поведение пчел и показывает это на главном экране. В хороший, безоблачный день много пчел приносят много меда, матка хорошо сеет. При увеличении ветра и ухудшении погоды рабочих пчел становится меньше, взяток меньше.




### Моделирование улья
В разделе **"Профиль взятка"** пчеловод может увидеть распределение потенциального взятка по месяцам. Профиль состоит из 3х графиков: базовый профиль для данной местности, расчетное время и продолжительность цветения основных медоносов. Расчет произодится на основании исторических данных об эффективной температуре. Третий график - это особая "фишка" нашего проекта - на основании мониторинга открытых источников: соцсетей, форумов, данных мониторинга окружающей среды мы определяем настоящее время начала и окончания цветения.

Для каждого **улья** есть возможность его осмотра, при котором можно узнать количество рамок в нем, тип рамки, осмотреть рамку и проконтролировать количество меда и расплода по типу, качество засева и сделать выводы о необходимости тех или иных действий над ульем. Статистика расплода в динамике, статистика взятка помогает ему в этом.


### Вклад в Бренд
Функция "Вклад в Бренд" моделирует повышение спроса на мед за счет маркетинга. Игрок может заниматься как самомаркетингом, самостоятельно развивая свой сайт, группы в соцсетях, работая на форумах - в этом случае мы учитываем его трудозатраты, т.к. эта деятельность не только требует специальных навыков и талантов, но и весьма трудоемка. Часть или всю эту работу игрок может отдать на аутсорс, повышая качество контента и освобождая свое время. Но тратя деньги из текущей или будущей прибыли. Заказывать рекламу в кредит нельзя, только за счет имеющихся или заемных средств.


### Прогноз спроса
Для самозанятых пчеловодов, с небольшой пасекой до 30 ульев основным каналом сбыта является "сарафанное радио", соцсети и "Авито". Повысить заработок в этом случае можно двумя способами: выбрать самую выгодную цену (а как известно из курса экономики при повышении цены спрос падает, но маржинальность растет, при понижении - наоборот. В зависимости от типа товара эта функция может иметь разную форму. И самая выгодная цена товара, при которой производитель получает максимум прибыли далеко не всегда самая низкая) и повысимость узнаваемость и "силу" бренда. Под словом бренд мы понимаем не только фирменное название продукта, но и "У Петровича самый лучший мед, всегда беру только у него". Повысить узнаваемость бренда можно и производя качественный продукт и вкладывая деньги в маркетинг: реклама в различных каналах, свой сайт, группы в соцсетях, каналы на Рутубе и ВК.Видео, посты у блогеров, местных и региональных СМИ.
Вкладывая в бренд, в его узнаваемость можно существенно увеличить прибыль пасеки. 

Функция "Прогноз спроса" и позволяет смоделировать увеличение прибыли за счет вклада в бренд и расширения пасеки.

Таким образом, мы делаем нашу игру полезной не только для тех, кто только задумывается, чтобы завести пчел, но и для тех мужичков 50+, кто сейчас занимается пчеловодством "для себя" и сподвигнуть их отрефлексировать, мол, "дал бы Катеньке 3 литра меда два года назад за пост у себя в группе, глядишь ее подружки мой прошлогодний остаток и раскупили-бы". "А то и Ниву бы прикупить: и сахару пчелкам привезти и на рыбалку сьездить. И самозанятым не грех с таких деньжищ стать: прокормят-то пчелки".








## Архитектура проекта
### Бекенд
Используется Flask. Эндпойнты логически объединены в файлы, подключаемые через Blueprint в основном файле app.py. БД - SQLite, название БД: "maya_db", ОРМ - SQLAlchemy. Миграции выполняются через alembic. Структура БД хранится в файле db.py

### Фронт
HTML5 + JS, фрейворки не используются. Десктоп версия оптимизирована для разрешения экрана 1024*800, мобильная версия - 320*568. Фон и интерактивные элементы выполнены в стиле советских учебников 50х-60х годов 20го века. Элементы управления выполнены в виде кнопок, расположены в правой части экрана в виде контекстно зависимого списка. При наведении мыши на кнопки и на интерактивные элементы фона они подсвечиваются.
Сценарий разбит на сцены.

### Админка
Выбор банков в игре. ТОДО - интеграция с рекламным сервисом.


## Сущности
### Улей
состоит из 3х магазинов по 12 рамок в каждом. Количество ульев свое для каждого пользователя.
может быть на пасеке или в инвентаре. 

### Рамка
может быть пустой (с вощиной), медовой, с расплодом
находится в инвентаре или в улье
горизонтальной прямоугольной формы, 86*46 ячеек сот
в полном улье в центре магазина 6 рамок с расплодом, по краям по 3 рамки с медом
в неполном улье рамки обсиживаются пчелами пропорционально этому раскладу, начиная с 1 рамки с расплодом в центре и 2 с медом по бокам

### Ячейки соты
находятся на рамке
может быть пустой, с открытым расплодом, с закрытым расплодом, медовой
дата откладки яйца маткой

### Пчелы
статистика пчел по дням жизни после вылупления, например:
пчел возрастом 1 день - 500;
пчел возрастом 2 дня - 450;
...
пчел возрастом 21 день - 250;
Количество пчел каждого дня пересчитывается в функции пересчета "Следующий день", 
т.е. на следующий день пчел этого дня становится столько-же, сколько было в предыдущем. 
Количество новых пчел первого дня зависит от яйценоскости матки и наличия свободных ячеек сот

### Взяток
количество меда, принесенного с цветов или полученного с подкормки

### Инвентарь
может содержать:
сахар (в кг.), медогонка, воскотопка, рамки (пустые или с медом), мед, воск







## Сценарий
Фон в виде поляны на которой расположены: 3 дерева - яблоня, вишня и груша; 3 кустарника: красная смородина, черная смородина, малинник; 4 улья (зависит от этапа игры, в начале игры их 4); 

**Сцена 1**. 
Кнопки управления в правой четверти экрана если пользователь уже залогинен:
- "Новая игра" - начать новую игру, по нажатию переключение на "Сцену 2"
- "Продолжить" - продолжить игру
- "Статистика" - просмотр статистики
- "Настройки" - настройки
- "Выход" - выход из игры

Кнопки управления если пользователь новый:
- надпись "Зарегистрироваться:" 
- кнопка "VK"
- кнопка "Телеграм"
- кнопка "Почта"
- кнопка "Войти"

**Сцена 2. Выбор места расположения пасеки.**.
 Показывается Yandex.карта с центром, определенном по GeoIP
- кнопка "Выбрать" - выбор места расположения пасеки, по нажатию переключение на "Сцену 3"
- кнопка "Назад" - возврат на предыдущую сцену


**Сцена 3. Окно настроек.**.
- текстовое поле "Город", начальное значение - ближайший город к точке, выбранной на карте в "Сцене 2";
- текстовое поле "Первый год", начальное значение - 2015;
- кнопка "Сохранить" - сохранение настроек, переход на "Сцену 4"
- кнопка "Назад" - возврат на предыдущую сцену

**Сцена 4. Основное окно программы.**.
Количество ульев на фоне соответствует количеству ульев у пользователя. В левой верхней части текст "Дата: (показывается текущая игровая дата). Кредит: (показывается долг банку со знаком минус). Наличные: (показывается количество наличных)."
- кнопка "Банк" - переход на "Сцену 5. Банк"
- кнопка "Авито" - переход на "Сцену 6. Авито"
- кнопка "Налог" - переход на "Сцену 7. Налог"
- кнопка "Инвентарь" - переход на "Сцену 8. Инвентарь"
- при выборе улья добавляется кнопка "Улей" - переход на "Сцену 9. Улей";
- кнопка "Следующий день" - пересчет данных;
- кнопка "Назад" - возврат на предыдущую сцену


**Сцена 5. Банк.**.
Фон в виде помещения банка с его представителем, сидящим за столом. На столе лежат бумаги, персональный компьютер
- кнопка "Мои кредиты" - показывается список кредитов пользователя в виде списка, который показывает представитель банка. 
- ТОДО кнопка "Рефинансирование";
- кнопка "Взять кредит" - переход на "Сцену 5а. Выбор кредита"
- кнопка "Отдать кредит" - переход на "Сцену 5б. Погашение кредита" 
- ТОДО кнопка "Банкротство";

- кнопка "Назад" - возврат на предыдущую сцену

**Сцена 5а. Выбор кредита**.
Показывается список кредитов, которые можно выбрать. Конкретные кредиты отображаются в виде кнопок, по нажатию появляется текстовое поле с указанием суммы кредитов.
- кнопка "Взять", изначально неактивная, становится активной, если выбран кредит и введена ненулевая сумма;
- кнопка "Назад" - возврат на предыдущую сцену

**Сцена 5б. Погашение кредита**.
Показывается список кредитов, который можно погасить. Сумма кредита должны быть меньше текущей суммы наличных.
- кнопка "Погасить;"
- кнопка "Назад" - возврат на предыдущую сцену


**Сцена 6. Авито.**.


**Сцена 10. Прогноз спроса.**.
По нажатию всплывает широкое модальное окно с двумя интерактивными графиками. 

График №1. Заголовок "Бренд "Волчий мед". Ниже слоган "Собран там, где волки ходить боятся". Ниже график. По оси X месяцы с апреля по март, по оси Y - потенциальный спрос. Начальные значения графика: апрель - 50, май - 30, июнь - 20, июль - 10, август - 30, сентябрь - 40, октябрь - 50, ноябрь - 60, декабрь - 70, январь - 30, февраль - 30, март - 30.
Справа от графика небольшая итоговая область: Меда собрано: , Заработано за год: 


Ниже графика горизонтальный ползунок на всю ширину графика. Подпись: "Цена меда".
Значения ползунка от 300 до 5000, начальное значение 600. При перемещении ползунка график пересчитывается: цене 600 соответствуют начальные значения графика. При уменьшении до 300 значения растут <уровень бренда> / 30. При увеличении до критического значения <уровень бренда> * 30 значения падают до начальных значений графика * <уровень бренда> * 0.57. После критического значения значения падают до начальных значений графика * <уровень бренда> * 0.17

Ниже графика горизонтальный ползунок на всю ширину графика. Подпись: "Уровень бренда".
Значения ползунка от -10 до 100, начальное значение 30. При перемещении ползунка график пересчитывается по вышеописанному алгоритму для цены.

Третий ползунок: "Количество ульев". Значения ползунка от 4 до 30, начальное значение 4.
При перемещении ползунка пересчитываются значения "Меда собрано" = <количество ульев> * 20, "Заработано за год: если сумма значений графика спроса больше <количество ульев> * 20, то <количество ульев> * "Цена меда" - <количество ульев>*2000, если меньше, то <сумма значений графика спроса> * "Цена меда" - <количество ульев>*2000

График №2. Заголовок "Бренд "Деснянский мед". По оси X месяцы с апреля по март, по оси Y - потенциальный спрос. Начальные значения графика: апрель - 100, май - 60, июнь - 80, июль - 90, август - 60, сентябрь - 40, октябрь - 60, ноябрь - 80, декабрь - 120, январь - 60, февраль - 80, март - 80.
Справа от графика небольшая итоговая область: Меда собрано: , Заработано за год: 

Ниже графика горизонтальный ползунок на всю ширину графика. Подпись: "Цена меда".
Значения ползунка от 100 до 1000, начальное значение 200. При перемещении ползунка график пересчитывается: цене 200 соответствуют начальные значения графика. При уменьшении до 100 значения растут <уровень бренда> / 30. При увеличении до критического значения <уровень бренда> * 10 значения падают до начальных значений графика * <уровень бренда> * 0.37. После критического значения значения падают до начальных значений графика * <уровень бренда> * 0.17

Ниже графика горизонтальный ползунок на всю ширину графика. Подпись: "Уровень бренда".
Значения ползунка от -30 до 30, начальное значение 0. При перемещении ползунка график пересчитывается по вышеописанному алгоритму для цены.

Третий ползунок: "Количество ульев". Значения ползунка от 4 до 30, начальное значение 4.
При перемещении ползунка пересчитываются значения "Меда собрано" = <количество ульев> * 60, "Заработано за год: если сумма значений графика спроса больше <количество ульев> * 60, то <количество ульев> * "Цена меда" - <количество ульев>*2000 - <количество ульев> * 30*50 (это цена сахара), если меньше, то <сумма значений графика спроса> * "Цена меда"- <количество ульев>*2000 - <количество ульев> * 30*50



**"Сцена 11. Коллаборации"**
По нажатию всплывает широкое модальное окно с закрепленной верхней строкой "Суммарно:" <стоимость> р. в месяц; <трудозатраты> ч.в сутки  - так удобнее
Дальше идет таблица из трех колонок. Первая, самая широкая - описание маркетинговых работ, вторая - стоимость работы в рублях и третья - трудозатраты в часах. Во второй и третьей колонках находятся чекбоксы, при выборе или снятии которых пересчитывается суммарная стоимость или трудозатратность выбранной работы. Если стоит прочерк - чекбокс неактивен

Свой сайт:
создание: 50 000 р. / 6 ч.
администрирование: 8 000 р. / 1 ч.
наполнение: 20 000 р. / 3 ч.

Контент:
текст: 20 000 р. / 28 ч.
видео: 50 000 р. / 56 ч.

Группы в соцсетях:
1. Красота без границ (1,1 млн) 50 000 р. / - ч.
2. Идеал красоты (720 т.) 30 000 р. / - ч.
3. Магия макияжа (340 т.) 35 000 р. / - ч.
4. Стильные метаморфозы (320 т.) 12 000 р. / - ч.
5. Искусство быть красивой (32 т.) 1 000 р. / - ч.

Посты у блогеров
1. FitLife_Guru (1,2 млн) 70 000 р. / - ч.
2. EcoEnergie (840 т.) 20 000 р. / 6 ч.
3. ZOJ_Power (510 т.) 10 000 р. / 18 ч.
4. HealthyHarmony (40 т.) 2 000 р. / 6 ч.
5. GreenBodyMind (30 т.) 20 000 р. / - ч.

Местные СМИ
1. Маяк (20 т.) 7 000 р. / - ч.
2. Зов Ильича (2 т.) 70 000 р. / 36 ч.

Всероссийские СМИ
1. RBC (3,2 млн) 170 000 р. / - ч.
2. Lenta.ru (23,7 млн) 200 000 р. / - ч.
3. Panorama (15,6 млн) 10 000 р. / - ч.
4. Yaplakal (56 млн) 20 000 р. / - ч.
5. Habr.com (7 млн) 120 000 р. / - ч.




**"Сцена 9. Улей"**
Фоном является изображение улья в схематичном разрезе. Количество показываемых рамок в улье соответствует реальному количеству для данного улья.
В нижней части 
- кнопка "Осмотр" - показывается горизонтальный скролл, который показывает все рамки улья. При двойном клике на медовую рамку она переносится в инвентарь. При двойном клике на пустое место появляется выбор: добавить пустую рамку, добавить медовую рамку, отмена.

- кнопка "Статистика пчел" - показывается статистика пчел, которая показывает количество пчел, которые улей содержит в разбиении по возрастам: Яйцо (0-3 дня) Личинка (3-9 дней), Куколка (9-12 дней), Нелетных Пчел (0-14 дней), Летных Пчел (более 14 дней);
- кнопка "Профиль взятка" - показывается профиль взятка
- "Подкормить" - текстовое поле, в котором можно ввести количество сахара, которым нужно подкормить;


- ТОДО кнопка "Банкротство";


- кнопка "Назад" - возврат на предыдущую сцену


### Функция пересчета "Следующий день"
- расчет процентных ставок для каждого банка на основе исторических данных. с вероятностью 0.01 банк может предложить кредит с пониженной ставкой (рекламная ставка), которая расчитывается случайным образом;
- расчет долга для каждого кредита;
- общая сумма долга, отображается в строке "Кредиты"

**Пчелы**
- Пересчет пчел:
    - возраст пчел увеличивается на 1 день (пчелы первого дня становятся пчелами второго и т.д.);
    - пчелы возрастом более 35-45 дней весной, летом и осенью постепенно погибают;
    - пчелы возрастом более 120-180 дней поздней осенью, зимой и ранней весной постепенно погибают;

- Пересчет ячеек сот: 
    - если ячейка с открытым расплодом и ее дата откладки яйца больше 9ти дней - тип соты меняется на "закрытый расплод";
    - если ячейка с закрытым расплодом и ее дата откладки яйца больше 12ти дней - тип соты меняется на "пустая", количество пчел 1-го дня увеличивается на 1;

- Пересчет взятка
    При старте игры в настройках случайно задается базовая величина взятка: 
    12–22 мг/сутки на летную пчелу
    - профиль взятка в данной местности: для каждого дня года устанавливается коэффициент от 0.1 до 1.2, который растет от 1 апреля до 1 июля и снижается до 1 октября с небольшим разбросом для каждого дня. Запросом к LLM определяются основные медоносы в выбранной местности, их эффективная температура и продолжительность цветения. Если сумма эффективных температур больше, необходимой для цветения, взяток увеличивается на коэффициент от 2 до 5. В дождливый день взятка нет, данные берутся из открытых источников.

    Формула пересчета:
    базовая величина * коэффициент профиля взятка для текущего дня * количество пчел возрастом более 14 дней


- Пересчет потребления корма:
    Формула пересчета:
    количество ячеек сот с открытым расплодом * 25 мг + количество пчел возрастом менее 14 дней * 7 мг + количество пчел возрастом более 14 дней * 15 мг

    Если количество взятка меньше потребления, расходуются запасы меда. Ячейки со сьеденным медом переходят в тип пустые. Сначала расходуется запас медовых рамок, потом с расплодом.

    Если количество корма меньше количества взятка + запас меда в ячейках - погибают пчелы и окрытый расплод пропорционально нехватке корма. Живыми остается то количество пчел и расплода, которым корма хватило


- Пересчет отложенных яиц: 
    При старте игры в настройках случайно задается базовая продуктивность матки:
    1000–2000 яиц/сутки
    и максимальная: Базовая * (случайное число от 1 до 2)
    также задаются коэффициенты зависимости от 
    1. Температура окружающей среды - минимум (случайное число от 0 до 0.2), максимум (0.8 - 1.2). Минимум соответствует температуре воздуха меньше 14 градусов и больше 40 градусов, максимум - 25 градусов
    2. Питание и доступность корма - минимум (случайное число от 0 до 0.2), максимум (0.8 - 1.2). Минимум соответствует полному отсутствию меда в улье, взятка и подкормки, максимум - если подкормки и взятка хватает на кормление всех пчел + запас в соты (случайное число от 0 до 0.2) * общая сумма необходимого корма
    4. Возраст матки - коэффициенты лет (случайное число от 1 до 0.5 для каждого года)
    5. Продолжительность светового дня - минимум (случайное число от 0 до 0.2) для минимальной продолжительности, максимум (0.8 - 1.2) для максимальной
    6. Количество рабочих пчел и сила семьи - минимум (случайное число от 0 до 0.2) для силы улья в три рамки нелетных пчел, максимум (0.8 - 1.4) для максимальной силы в 24 рамки нелетных пчел

    
    Формула пересчета:
    базовая продуктивность матки * коэффициент зависимости от температуры окружающей среды * коэффициент зависимости от питания и доступности корма * коэффициент зависимости от возраста матки * коэффициент зависимости от продолжительности светового дня * коэффициент зависимости от силы улья 

    - Пересчет ячеек сот:
       Формула пересчета:
       Вся подкормка переходит в запас меда;
       если взятка не хватает на кормление, расходуется мед: ячейки со сьеденным медом переходят в разряд пустые;
       если взятка + подкормка больше расхода, мед переходит в запас меда; сначала заполняются ячейки с расплодом сверху на 1/3 высоты, потом с медовыми рамками сверху на 3/4 высоты; в одной ячейке 0,2 г меда

        Матка откладывает яйца в пустые ячейки начиная с центральной рамки улья, по спирали засевает сначала центральные рамки с расплодом, потом медовые по краям улья



