{% extends "base.html" %}

{% block title %}–£–ª–µ–π {{ hive.name }} - –ü—á–µ–ª–∫–∞ –ú–∞–π—è{% endblock %}

{% block head %}
    {{ super() }}
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Chart.js –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkChartJS() {
            console.log('=== –ü–†–û–í–ï–†–ö–ê CHART.JS ===');
            console.log('typeof Chart:', typeof Chart);
            console.log('window.Chart:', window.Chart);
            
            // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å Chart.js
            if (typeof Chart === 'undefined') {
                console.log('Chart –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º...');
                var script = document.createElement('script');
                script.src = '/static/js/chart.min.js';
                script.onload = function() {
                    console.log('‚úÖ Chart.js –∑–∞–≥—Ä—É–∂–µ–Ω');
                    console.log('typeof Chart –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:', typeof Chart);
                };
                script.onerror = function() {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Chart.js');
                };
                document.head.appendChild(script);
            } else {
                console.log('‚úÖ Chart.js —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        checkChartJS();
        
        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkChartJS, 100);
        });
    </script>
{% endblock %}

{% block content %}
<div class="hive-interface">
    <div class="hive-diagram">
        <div class="hive-cross-section">
            <!-- –°—Ö–µ–º–∞—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–ª—å—è –≤ —Ä–∞–∑—Ä–µ–∑–µ -->
            <div class="hive-body-3d">
                <div class="hive-section" data-section="top">
                    <div class="section-label">–í–µ—Ä—Ö–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω</div>
                    <div class="frames-grid">
                        {% for i in range(12) %}
                        <div class="frame-slot" data-frame="{{ i }}">
                            <div class="frame-visual"></div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="hive-section" data-section="middle">
                    <div class="section-label">–°—Ä–µ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω</div>
                    <div class="frames-grid">
                        {% for i in range(12, 24) %}
                        <div class="frame-slot" data-frame="{{ i }}">
                            <div class="frame-visual"></div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="hive-section" data-section="bottom">
                    <div class="section-label">–ù–∏–∂–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω</div>
                    <div class="frames-grid">
                        {% for i in range(24, 36) %}
                        <div class="frame-slot" data-frame="{{ i }}">
                            <div class="frame-visual"></div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="hive-controls">
        <button class="btn btn-primary" onclick="showModal('–û—Å–º–æ—Ç—Ä —É–ª—å—è', getInspectionContent())">
            –û—Å–º–æ—Ç—Ä
        </button>
        
        <button class="btn btn-secondary" onclick="showBeesStats()">
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª
        </button>
        
        <button class="btn btn-secondary" onclick="showNectarProfile()">
            –ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞
        </button>
        
        <button class="btn btn-secondary" onclick="showModal('–ü–æ–¥–∫–æ—Ä–º–∫–∞', getFeedingContent())">
            –ü–æ–¥–∫–æ—Ä–º–∏—Ç—å
        </button>
        
        <button class="btn btn-danger" onclick="window.location.href='/game/main'">
            –ù–∞–∑–∞–¥
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É–ª—å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
document.addEventListener('DOMContentLoaded', function() {
    loadHiveData();
});

async function loadHiveData() {
    const hiveId = {{ hive.id }};
    
    try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—á–µ–ª
        const statsResponse = await fetch(`/api/hive/${hiveId}/stats`);
        if (statsResponse.ok) {
            const stats = await statsResponse.json();
            updateHiveVisualization(stats);
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞
        const profileResponse = await fetch(`/api/hive/${hiveId}/nectar_profile`);
        if (profileResponse.ok) {
            const profile = await profileResponse.json();
            updateNectarDisplay(profile);
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É–ª—å—è:', error);
        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É–ª—å—è', 'error');
    }
}

function updateHiveVisualization(stats) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —É–ª—å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    const frames = document.querySelectorAll('.frame-slot');
    
    frames.forEach((frame, index) => {
        const frameVisual = frame.querySelector('.frame-visual');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä–∞–º–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–∏
        if (index >= 15 && index <= 20) {
            // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —Ä–∞–º–∫–∏ —Å —Ä–∞—Å–ø–ª–æ–¥–æ–º
            frameVisual.style.background = `linear-gradient(45deg, #8B4513, #A0522D)`;
            frameVisual.title = `–†–∞–º–∫–∞ —Å —Ä–∞—Å–ø–ª–æ–¥–æ–º`;
        } else {
            // –ú–µ–¥–æ–≤—ã–µ —Ä–∞–º–∫–∏
            frameVisual.style.background = `linear-gradient(45deg, #FFD700, #DAA520)`;
            frameVisual.title = `–ú–µ–¥–æ–≤–∞—è —Ä–∞–º–∫–∞`;
        }
    });
}

function updateNectarDisplay(profile) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∑—è—Ç–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const hiveControls = document.querySelector('.hive-controls');
    if (hiveControls) {
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        const existingInfo = hiveControls.querySelector('.nectar-info');
        if (existingInfo) {
            existingInfo.remove();
        }
        
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        const nectarInfo = document.createElement('div');
        nectarInfo.className = 'nectar-info';
        nectarInfo.innerHTML = `
            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∑—è—Ç–∫–µ</h5>
            <p><strong>–ì–æ—Ä–æ–¥:</strong> ${profile.city || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</p>
            <p><strong>–ë–∞–∑–æ–≤—ã–π –≤–∑—è—Ç–æ–∫:</strong> ${profile.base_nectar?.toFixed(1) || '0.0'} –º–≥/—Å—É—Ç–∫–∏</p>
            <p><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–µ–∑–æ–Ω–∞:</strong> ${profile.current_coefficient?.toFixed(2) || '1.00'}</p>
            <p><strong>–¢–µ–∫—É—â–∏–π –≤–∑—è—Ç–æ–∫:</strong> ${(profile.base_nectar * profile.current_coefficient)?.toFixed(1) || '0.0'} –º–≥/—Å—É—Ç–∫–∏</p>
        `;
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
        const backButton = hiveControls.querySelector('.btn-danger');
        if (backButton) {
            hiveControls.insertBefore(nectarInfo, backButton);
        } else {
            hiveControls.appendChild(nectarInfo);
        }
    }
}

function getInspectionContent() {
    return `
        <h4>–û—Å–º–æ—Ç—Ä —Ä–∞–º–æ–∫ —É–ª—å—è</h4>
        <div class="inspection-grid">
            {% for frame in hive.frames %}
            <div class="frame-inspection" onclick="inspectFrame({{ frame.id }})">
                <div class="frame-number">–†–∞–º–∫–∞ {{ frame.position + 1 }}</div>
                <div class="frame-type">{{ frame.frame_type.value }}</div>
                <div class="frame-cells">
                    {% set cell_count = frame.cells|length %}
                    –Ø—á–µ–µ–∫: {{ cell_count }}
                </div>
            </div>
            {% endfor %}
        </div>
        <p class="mt-20">
            <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –º–µ–¥–æ–≤–æ–π —Ä–∞–º–∫–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –µ—ë –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.
            –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–º–∫–∏.
        </p>
    `;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª"
async function showBeesStats() {
    try {
        const statsContent = await getBeesStats();
        showModal('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª', statsContent);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        setTimeout(() => {
            loadHistoricalChart();
            loadDetailedCalculations();
        }, 100);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—á–µ–ª:', error);
        showModal('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª', '<div class="error-message"><p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p></div>');
    }
}

async function getBeesStats() {
    try {
        const hiveId = {{ hive.id }};
        const response = await fetch(`/api/hive/${hiveId}/stats`);
        
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
        }
        
        const stats = await response.json();
        
        return `
            <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª</h4>
            <div class="bees-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="eggs-count">${stats.eggs || 0}</div>
                        <div class="stat-label">–Ø–π—Ü–∞ (0-3 –¥–Ω—è)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="larvae-count">${stats.larvae || 0}</div>
                        <div class="stat-label">–õ–∏—á–∏–Ω–∫–∏ (3-9 –¥–Ω–µ–π)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pupae-count">${stats.pupae || 0}</div>
                        <div class="stat-label">–ö—É–∫–æ–ª–∫–∏ (9-12 –¥–Ω–µ–π)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="non-flying-count">${stats.non_flying || 0}</div>
                        <div class="stat-label">–ù–µ–ª–µ—Ç–Ω—ã–µ –ø—á–µ–ª—ã (0-14 –¥–Ω–µ–π)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="flying-count">${stats.flying || 0}</div>
                        <div class="stat-label">–õ–µ—Ç–Ω—ã–µ –ø—á–µ–ª—ã (–±–æ–ª–µ–µ 14 –¥–Ω–µ–π)</div>
                    </div>
                </div>
                <div class="stats-summary mt-20">
                    <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—á–µ–ª:</strong> ${(stats.eggs || 0) + (stats.larvae || 0) + (stats.pupae || 0) + (stats.non_flying || 0) + (stats.flying || 0)}</p>
                    <p><strong>–†–∞—Å–ø–ª–æ–¥ (—è–π—Ü–∞ + –ª–∏—á–∏–Ω–∫–∏ + –∫—É–∫–æ–ª–∫–∏):</strong> ${(stats.eggs || 0) + (stats.larvae || 0) + (stats.pupae || 0)}</p>
                    <p><strong>–†–∞–±–æ—á–∏–µ –ø—á–µ–ª—ã:</strong> ${(stats.non_flying || 0) + (stats.flying || 0)}</p>
                </div>
                
                <div class="historical-chart mt-30">
                    <h5>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—á–µ–ª –ø–æ –¥–Ω—è–º</h5>
                    <div class="chart-container">
                        <canvas id="historicalChart" width="500" height="250"></canvas>
                    </div>
                </div>
                
                <div class="detailed-calculations mt-30">
                    <h5>–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã</h5>
                    <div id="calculations-content">
                        <div class="loading-message">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤...</div>
                    </div>
                </div>
            </div>
        `;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—á–µ–ª:', error);
        return `
            <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—á–µ–ª</h4>
            <div class="error-message">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                <p>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${error.message}</p>
            </div>
        `;
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞"
async function showNectarProfile() {
    try {
        const profileContent = await getNectarProfile();
        showModal('–ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞', profileContent);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è –≤–∑—è—Ç–∫–∞:', error);
        showModal('–ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞', '<div class="error-message"><p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –≤–∑—è—Ç–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p></div>');
    }
}

async function getNectarProfile() {
    try {
        const hiveId = {{ hive.id }};
        const response = await fetch(`/api/hive/${hiveId}/nectar_profile`);
        
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –≤–∑—è—Ç–∫–∞');
        }
        
        const profile = await response.json();
        
        return `
            <h4>–ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞</h4>
            <div class="nectar-profile">
                <div class="profile-info">
                    <div class="stat-card">
                        <div class="stat-value" id="base-nectar">${profile.base_nectar?.toFixed(1) || '0.0'}</div>
                        <div class="stat-label">–ë–∞–∑–æ–≤—ã–π –≤–∑—è—Ç–æ–∫ (–º–≥/—Å—É—Ç–∫–∏)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-coefficient">${profile.current_coefficient?.toFixed(2) || '1.00'}</div>
                        <div class="stat-label">–¢–µ–∫—É—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="city-name">${profile.city || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</div>
                        <div class="stat-label">–ì–æ—Ä–æ–¥</div>
                    </div>
                </div>
                <div class="nectar-calculation mt-20">
                    <h5>–†–∞—Å—á–µ—Ç –≤–∑—è—Ç–∫–∞</h5>
                    <p><strong>–¢–µ–∫—É—â–∏–π –≤–∑—è—Ç–æ–∫:</strong> ${(profile.base_nectar * profile.current_coefficient)?.toFixed(1) || '0.0'} –º–≥/—Å—É—Ç–∫–∏</p>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –í–∑—è—Ç–æ–∫ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ—Å—Ç–Ω–æ—Å—Ç–∏, —Å–µ–∑–æ–Ω–Ω–æ–≥–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–µ—Ç–Ω—ã—Ö –ø—á–µ–ª.</p>
                </div>
                <div class="profile-chart mt-20">
                    <canvas id="nectarChart" width="400" height="200"></canvas>
                    <p class="chart-note">–ì—Ä–∞—Ñ–∏–∫ –≤–∑—è—Ç–∫–∞ –ø–æ –¥–Ω—è–º –≥–æ–¥–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>
                </div>
            </div>
        `;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –≤–∑—è—Ç–∫–∞:', error);
        return `
            <h4>–ü—Ä–æ—Ñ–∏–ª—å –≤–∑—è—Ç–∫–∞</h4>
            <div class="error-message">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –≤–∑—è—Ç–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                <p>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${error.message}</p>
            </div>
        `;
    }
}

function getFeedingContent() {
    return `
        <h4>–ü–æ–¥–∫–æ—Ä–º–∫–∞ —É–ª—å—è</h4>
        <div class="feeding-form">
            <div class="form-group">
                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∞—Ö–∞—Ä–∞ (–∫–≥):</label>
                <input type="number" class="form-control" id="feeding-amount" 
                       min="0.1" max="100" step="0.1" value="1">
            </div>
            <div class="feeding-info">
                <p><strong>–¢–µ–∫—É—â–∏–π –∑–∞–ø–∞—Å —Å–∞—Ö–∞—Ä–∞:</strong> <span id="current-sugar">-</span> –∫–≥</p>
                <p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –¥–æ–∑–∞:</strong> 1-5 –∫–≥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ–∑–æ–Ω–∞</p>
            </div>
            <button class="btn btn-primary" onclick="performFeeding()">
                –ü–æ–¥–∫–æ—Ä–º–∏—Ç—å
            </button>
        </div>
    `;
}

async function performFeeding() {
    const amount = parseFloat(document.getElementById('feeding-amount').value);
    const hiveId = {{ hive.id }};
    
    if (amount <= 0) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error');
        return;
    }
    
    await feedHive(hiveId, amount);
    closeModal();
}

async function inspectFrame(frameId) {
    // –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Å–º–æ—Ç—Ä —Ä–∞–º–∫–∏
    try {
        const frameData = await getFrameCells(frameId);
        showFrameModal(frameData);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–º–∫–∏:', error);
        showModal('–û—Å–º–æ—Ç—Ä —Ä–∞–º–∫–∏', `
            <h4>–†–∞–º–∫–∞ #${frameId}</h4>
            <div class="error-message">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–º–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                <p>–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: ${error.message}</p>
            </div>
        `);
    }
}

async function getFrameCells(frameId) {
    const response = await fetch(`/api/frame/${frameId}/cells`);
    
    if (!response.ok) {
        throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–º–∫–∏');
    }
    
    return await response.json();
}

function showFrameModal(frameData) {
    const frameInfo = frameData.frame_info;
    const cellStats = frameData.cell_stats;
    const broodDistribution = frameData.brood_age_distribution;
    
    const modalContent = `
        <h4>–†–∞–º–∫–∞ #${frameInfo.position + 1} (${frameInfo.frame_type})</h4>
        
        <div class="frame-detail">
            <div class="frame-stats">
                <h5>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–º–∫–∏</h5>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">–ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏:</span>
                        <span class="stat-value">${cellStats.empty}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">–û—Ç–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥:</span>
                        <span class="stat-value">${cellStats.open_brood}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">–ó–∞–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥:</span>
                        <span class="stat-value">${cellStats.closed_brood}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">–ú–µ–¥–æ–≤—ã–µ —è—á–µ–π–∫–∏:</span>
                        <span class="stat-value">${cellStats.honey}</span>
                    </div>
                </div>
                
                <div class="brood-distribution">
                    <h6>–í–æ–∑—Ä–∞—Å—Ç —Ä–∞—Å–ø–ª–æ–¥–∞:</h6>
                    <div class="age-stats">
                        <div class="age-item">
                            <span class="age-label">–Ø–π—Ü–∞ (0-3 –¥–Ω—è):</span>
                            <span class="age-value">${broodDistribution.eggs}</span>
                        </div>
                        <div class="age-item">
                            <span class="age-label">–õ–∏—á–∏–Ω–∫–∏ (3-9 –¥–Ω–µ–π):</span>
                            <span class="age-value">${broodDistribution.larvae}</span>
                        </div>
                        <div class="age-item">
                            <span class="age-label">–ö—É–∫–æ–ª–∫–∏ (9-12 –¥–Ω–µ–π):</span>
                            <span class="age-value">${broodDistribution.pupae}</span>
                        </div>
                    </div>
                </div>
                
                <div class="honey-info">
                    <h6>–ó–∞–ø–∞—Å –º–µ–¥–∞:</h6>
                    <p><strong>${frameData.total_honey.toFixed(2)} –≥—Ä–∞–º–º</strong> –≤ ${cellStats.honey} —è—á–µ–π–∫–∞—Ö</p>
                </div>
            </div>
            
            <div class="frame-visualization">
                <h5>–°—Ö–µ–º–∞—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–º–∫–∏</h5>
                <div class="frame-cells-grid">
                    ${generateFrameCellsHTML(frameData.cells)}
                </div>
                <div class="legend">
                    <h6>–£—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:</h6>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="legend-cell empty-cell"></div>
                            <span>–ü—É—Å—Ç–∞—è</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-cell open-brood-cell"></div>
                            <span>–û—Ç–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-cell closed-brood-cell"></div>
                            <span>–ó–∞–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-cell honey-cell"></div>
                            <span>–ú–µ–¥–æ–≤–∞—è</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="frame-actions">
                <button class="btn btn-primary" onclick="extractHoney(${frameInfo.id})">
                    –û—Ç–∫–∞—á–∞—Ç—å –º–µ–¥
                </button>
                <button class="btn btn-secondary" onclick="replaceFrame(${frameInfo.id})">
                    –ó–∞–º–µ–Ω–∏—Ç—å —Ä–∞–º–∫—É
                </button>
            </div>
        </div>
    `;
    
    showModal('–û—Å–º–æ—Ç—Ä —Ä–∞–º–∫–∏', modalContent);
}

function generateFrameCellsHTML(cells) {
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —è—á–µ–π–∫–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏
    const cellMap = {};
    let maxX = 0;
    let maxY = 0;
    
    cells.forEach(cell => {
        const key = `${cell.x}-${cell.y}`;
        cellMap[key] = cell;
        maxX = Math.max(maxX, cell.x);
        maxY = Math.max(maxY, cell.y);
    });
    
    let html = '';
    
    // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É —è—á–µ–µ–∫
    for (let y = 0; y <= maxY; y++) {
        html += '<div class="cells-row">';
        for (let x = 0; x <= maxX; x++) {
            const key = `${x}-${y}`;
            const cell = cellMap[key];
            
            if (cell) {
                const cellClass = getCellClass(cell.cell_type);
                const cellTitle = getCellTitle(cell);
                
                html += `
                    <div class="frame-cell ${cellClass}" 
                         title="${cellTitle}"
                         data-cell-type="${cell.cell_type}"
                         data-brood-age="${cell.brood_age || ''}"
                         data-honey-amount="${cell.honey_amount || 0}"
                         onclick="showCellInfo(${cell.id}, '${cell.cell_type}', ${cell.brood_age || 'null'}, ${cell.honey_amount || 0})">
                    </div>
                `;
            } else {
                // –ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ –≤ —Å–µ—Ç–∫–µ
                html += '<div class="frame-cell empty-space"></div>';
            }
        }
        html += '</div>';
    }
    
    return html;
}

function getCellClass(cellType) {
    switch (cellType) {
        case 'empty':
            return 'empty-cell';
        case 'open_brood':
            return 'open-brood-cell';
        case 'closed_brood':
            return 'closed-brood-cell';
        case 'honey':
            return 'honey-cell';
        default:
            return 'empty-cell';
    }
}

function getCellTitle(cell) {
    switch (cell.cell_type) {
        case 'empty':
            return '–ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞';
        case 'open_brood':
            return `–û—Ç–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥${cell.brood_age !== null ? `, –≤–æ–∑—Ä–∞—Å—Ç: ${cell.brood_age} –¥–Ω.` : ''}`;
        case 'closed_brood':
            return `–ó–∞–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥${cell.brood_age !== null ? `, –≤–æ–∑—Ä–∞—Å—Ç: ${cell.brood_age} –¥–Ω.` : ''}`;
        case 'honey':
            return `–ú–µ–¥–æ–≤–∞—è —è—á–µ–π–∫–∞, ${cell.honey_amount}–≥ –º–µ–¥–∞`;
        default:
            return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
    }
}

function showCellInfo(cellId, cellType, broodAge, honeyAmount) {
    let info = `–Ø—á–µ–π–∫–∞ #${cellId}\n\n`;
    
    switch (cellType) {
        case 'empty':
            info += '–¢–∏–ø: –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞';
            break;
        case 'open_brood':
            info += `–¢–∏–ø: –û—Ç–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥\n–í–æ–∑—Ä–∞—Å—Ç: ${broodAge} –¥–Ω–µ–π`;
            break;
        case 'closed_brood':
            info += `–¢–∏–ø: –ó–∞–∫—Ä—ã—Ç—ã–π —Ä–∞—Å–ø–ª–æ–¥\n–í–æ–∑—Ä–∞—Å—Ç: ${broodAge} –¥–Ω–µ–π`;
            break;
        case 'honey':
            info += `–¢–∏–ø: –ú–µ–¥–æ–≤–∞—è —è—á–µ–π–∫–∞\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–¥–∞: ${honeyAmount}–≥`;
            break;
    }
    
    showNotification(info, 'info');
}

function extractHoney(frameId) {
    showNotification(`–û—Ç–∫–∞—á–∫–∞ –º–µ–¥–∞ —Å —Ä–∞–º–∫–∏ ${frameId} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
}

function replaceFrame(frameId) {
    showNotification(`–ó–∞–º–µ–Ω–∞ —Ä–∞–º–∫–∏ ${frameId} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –ø–æ —Ä–∞–º–∫–∞–º
document.addEventListener('dblclick', function(e) {
    if (e.target.closest('.frame-slot')) {
        const frameSlot = e.target.closest('.frame-slot');
        const frameNumber = frameSlot.dataset.frame;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π —Å —Ä–∞–º–∫–æ–π
        showFrameMenu(frameNumber);
    }
});

function showFrameMenu(frameNumber) {
    showModal('–î–µ–π—Å—Ç–≤–∏–µ —Å —Ä–∞–º–∫–æ–π', `
        <h4>–†–∞–º–∫–∞ ${parseInt(frameNumber) + 1}</h4>
        <div class="frame-menu">
            <button class="btn btn-primary" onclick="addEmptyFrame(${frameNumber})">
                –î–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—É—é —Ä–∞–º–∫—É
            </button>
            <button class="btn btn-primary" onclick="addHoneyFrame(${frameNumber})">
                –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–æ–≤—É—é —Ä–∞–º–∫—É
            </button>
            <button class="btn btn-danger" onclick="removeFrame(${frameNumber})">
                –£–¥–∞–ª–∏—Ç—å —Ä–∞–º–∫—É
            </button>
        </div>
    `);
}

function addEmptyFrame(frameNumber) {
    showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç–æ–π —Ä–∞–º–∫–∏ ${frameNumber} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
}

function addHoneyFrame(frameNumber) {
    showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–æ–≤–æ–π —Ä–∞–º–∫–∏ ${frameNumber} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
}

function removeFrame(frameNumber) {
    showNotification(`–£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏ ${frameNumber} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
async function loadHistoricalChart() {
    try {
        console.log('=== –ù–ê–ß–ê–õ–û –ó–ê–ì–†–£–ó–ö–ò –ì–†–ê–§–ò–ö–ê ===');
        
        const hiveId = {{ hive.id }};
        const response = await fetch(`/api/hive/${hiveId}/historical_data`);
        
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö: ' + response.status);
        }
        
        const data = await response.json();
        
        if (!data.dates || !data.brood_counts || !data.bee_counts) {
            throw new Error('–ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Chart.js
        if (typeof Chart === 'undefined') {
            console.log('Chart.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫...');
            createSimpleChart(data);
            return;
        }
        
        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Å Chart.js
        createChartJSChart(data);
        
    } catch (error) {
        console.error('=== –û–®–ò–ë–ö–ê –ì–†–ê–§–ò–ö–ê ===', error);
        showChartError(error.message);
    }
}
        
// –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å Chart.js
function createChartJSChart(data) {
    try {
        const ctx = document.getElementById('historicalChart').getContext('2d');
        
        const chartConfig = {
            type: 'line',
            data: {
                labels: data.dates.map(date => {
                    const d = new Date(date);
                    return d.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric' });
                }),
                datasets: [{
                    label: '–†–∞—Å–ø–ª–æ–¥',
                    data: data.brood_counts,
                    borderColor: '#8B4513',
                    backgroundColor: 'rgba(139, 69, 19, 0.1)',
                    borderWidth: 2,
                    fill: true
                }, {
                    label: '–í—Å–µ –ø—á–µ–ª—ã',
                    data: data.bee_counts,
                    borderColor: '#DAA520',
                    backgroundColor: 'rgba(218, 165, 32, 0.1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: `–†–∞–∑–≤–∏—Ç–∏–µ –ø—á–µ–ª–∏–Ω–æ–π —Å–µ–º—å–∏ –≤ —É–ª—å–µ "${data.hive_name}" (30 –¥–Ω–µ–π)`
                    },
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–æ–±–µ–π'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–î–∞—Ç–∞'
                        }
                    }
                }
            }
        };
        
        new Chart(ctx, chartConfig);
        console.log('‚úÖ –ì—Ä–∞—Ñ–∏–∫ Chart.js —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Chart.js –≥—Ä–∞—Ñ–∏–∫–∞:', error);
        createSimpleChart(data);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –±–µ–∑ Chart.js
function createSimpleChart(data) {
    try {
        const canvas = document.getElementById('historicalChart');
        const ctx = canvas.getContext('2d');
        
        // –û—á–∏—â–∞–µ–º canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞
        const padding = 60; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π
        const chartWidth = canvas.width - 2 * padding;
        const chartHeight = canvas.height - 2 * padding;
        
        // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–∫—Ä—É–≥–ª—è–µ–º
        const maxValue = Math.ceil(Math.max(...data.brood_counts, ...data.bee_counts) / 100) * 100;
        const minValue = 0;
        
        // –†–∏—Å—É–µ–º –æ—Å–∏
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, canvas.height - padding);
        ctx.lineTo(canvas.width - padding, canvas.height - padding);
        ctx.stroke();
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É Y
        function getY(value) {
            return canvas.height - padding - ((value - minValue) / (maxValue - minValue)) * chartHeight;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É X
        function getX(index) {
            return padding + (index / (data.dates.length - 1)) * chartWidth;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç–∫—É –∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –æ—Å–∏ Y
        ctx.strokeStyle = '#ddd';
        ctx.lineWidth = 1;
        ctx.fillStyle = '#666';
        ctx.font = '11px Arial';
        ctx.textAlign = 'right';
        
        const ySteps = 5;
        for (let i = 0; i <= ySteps; i++) {
            const value = minValue + (maxValue - minValue) * i / ySteps;
            const y = getY(value);
            
            // –†–∏—Å—É–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é —Å–µ—Ç–∫–∏
            ctx.beginPath();
            ctx.moveTo(padding, y);
            ctx.lineTo(canvas.width - padding, y);
            ctx.stroke();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            ctx.fillText(Math.round(value).toString(), padding - 5, y + 4);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –æ—Å–∏ X (—Ç–æ–ª—å–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏)
        ctx.textAlign = 'center';
        const xSteps = Math.min(6, data.dates.length);
        for (let i = 0; i < xSteps; i++) {
            const index = Math.floor(i * (data.dates.length - 1) / (xSteps - 1));
            const x = getX(index);
            const date = new Date(data.dates[index]);
            const dateStr = date.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric' });
            
            // –†–∏—Å—É–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é
            ctx.strokeStyle = '#eee';
            ctx.beginPath();
            ctx.moveTo(x, padding);
            ctx.lineTo(x, canvas.height - padding);
            ctx.stroke();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É
            ctx.fillStyle = '#666';
            ctx.fillText(dateStr, x, canvas.height - padding + 15);
        }
        
        // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é —Ä–∞—Å–ø–ª–æ–¥–∞
        ctx.strokeStyle = '#8B4513';
        ctx.lineWidth = 3;
        ctx.beginPath();
        data.brood_counts.forEach((value, index) => {
            const x = getX(index);
            const y = getY(value);
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        ctx.stroke();
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ª–∏–Ω–∏–∏ —Ä–∞—Å–ø–ª–æ–¥–∞
        data.brood_counts.forEach((value, index) => {
            const x = getX(index);
            const y = getY(value);
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);
            ctx.fill();
        });
        
        // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –≤—Å–µ—Ö –ø—á–µ–ª
        ctx.strokeStyle = '#DAA520';
        ctx.lineWidth = 3;
        ctx.beginPath();
        data.bee_counts.forEach((value, index) => {
            const x = getX(index);
            const y = getY(value);
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        ctx.stroke();
        
        // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ –Ω–∞ –ª–∏–Ω–∏–∏ –≤—Å–µ—Ö –ø—á–µ–ª
        data.bee_counts.forEach((value, index) => {
            const x = getX(index);
            const y = getY(value);
            ctx.fillStyle = '#DAA520';
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);
            ctx.fill();
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        ctx.fillStyle = '#333';
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`–†–∞–∑–≤–∏—Ç–∏–µ –ø—á–µ–ª–∏–Ω–æ–π —Å–µ–º—å–∏ –≤ —É–ª—å–µ "${data.hive_name}" (30 –¥–Ω–µ–π)`, canvas.width / 2, 25);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π
        ctx.font = '12px Arial';
        ctx.fillStyle = '#333';
        
        // –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ Y
        ctx.save();
        ctx.translate(15, canvas.height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = 'center';
        ctx.fillText('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–æ–±–µ–π', 0, 0);
        ctx.restore();
        
        // –ü–æ–¥–ø–∏—Å—å –æ—Å–∏ X
        ctx.textAlign = 'center';
        ctx.fillText('–î–∞—Ç–∞', canvas.width / 2, canvas.height - 10);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–µ–Ω–¥—É
        const legendY = canvas.height - padding + 35;
        ctx.fillStyle = '#8B4513';
        ctx.fillRect(padding, legendY, 20, 4);
        ctx.fillStyle = '#333';
        ctx.textAlign = 'left';
        ctx.fillText('–†–∞—Å–ø–ª–æ–¥ (—è–π—Ü–∞ + –ª–∏—á–∏–Ω–∫–∏ + –∫—É–∫–æ–ª–∫–∏)', padding + 25, legendY + 4);
        
        ctx.fillStyle = '#DAA520';
        ctx.fillRect(padding + 250, legendY, 20, 4);
        ctx.fillStyle = '#333';
        ctx.fillText('–í—Å–µ –ø—á–µ–ª—ã', padding + 275, legendY + 4);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö
        const latestBrood = data.brood_counts[data.brood_counts.length - 1];
        const latestBees = data.bee_counts[data.bee_counts.length - 1];
        
        ctx.font = '11px Arial';
        ctx.fillStyle = '#666';
        ctx.textAlign = 'right';
        ctx.fillText(`–¢–µ–∫—É—â–∏–π —Ä–∞—Å–ø–ª–æ–¥: ${latestBrood} –æ—Å–æ–±–µ–π`, canvas.width - 10, legendY + 4);
        ctx.fillText(`–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—á–µ–ª: ${latestBees} –æ—Å–æ–±–µ–π`, canvas.width - 10, legendY + 18);
        
        console.log('‚úÖ –ü—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ —Å –ø–æ–¥–ø–∏—Å—è–º–∏ –æ—Å–µ–π');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
        showChartError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫');
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –≥—Ä–∞—Ñ–∏–∫–∞
function showChartError(message) {
    const chartContainer = document.querySelector('.chart-container');
    if (chartContainer) {
        chartContainer.innerHTML = `
            <div class="error-message">
                <h6>üìä –ì—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</h6>
                <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${message}</p>
                <p><strong>–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∏–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</strong></p>
                <p><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</small></p>
            </div>
        `;
    }
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
async function loadDetailedCalculations() {
    try {
        const hiveId = {{ hive.id }};
        const response = await fetch(`/api/hive/${hiveId}/detailed_calculations`);
        
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤');
        }
        
        const data = await response.json();
        const calculationsContent = document.getElementById('calculations-content');
        
        if (!calculationsContent) return;
        
        let html = `
            <div class="calculations-grid">
                <div class="calc-section">
                    <h6>üí∞ –†–∞—Å—á–µ—Ç –≤–∑—è—Ç–∫–∞</h6>
                    <div class="formula-box">
                        <p><strong>–§–æ—Ä–º—É–ª–∞:</strong></p>
                        <p class="formula">${data.nectar_calculation.base_formula}</p>
                        <p><strong>–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π:</strong></p>
                        <p class="calculation">${data.nectar_calculation.calculation}</p>
                        <div class="result">
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${data.nectar_calculation.result?.toFixed(1) || '0.0'} –º–≥/—Å—É—Ç–∫–∏</strong>
                        </div>
                    </div>
                </div>
                
                <div class="calc-section">
                    <h6>üçØ –†–∞—Å—á–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –º–µ–¥–∞</h6>
                    <div class="formula-box">
                        <p><strong>–§–æ—Ä–º—É–ª–∞:</strong></p>
                        <p class="formula">${data.consumption_calculation.base_formula}</p>
                        <p><strong>–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π:</strong></p>
                        <p class="calculation">${data.consumption_calculation.calculation}</p>
                        <div class="result">
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${data.consumption_calculation.result} –º–≥/—Å—É—Ç–∫–∏</strong>
                        </div>
                    </div>
                </div>
                
                <div class="calc-section">
                    <h6>‚öñÔ∏è –ë–∞–ª–∞–Ω—Å –≤–∑—è—Ç–∫–∞ –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è</h6>
                    <div class="balance-box">
                        <div class="balance-item">
                            <span>–î–æ—Å—Ç—É–ø–Ω–æ –≤–∑—è—Ç–∫–∞:</span>
                            <span>${data.balance.nectar_available?.toFixed(1) || '0.0'} –º–≥</span>
                        </div>
                        <div class="balance-item">
                            <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä–º–∞:</span>
                            <span>${data.balance.consumption_needed} –º–≥</span>
                        </div>
                        <div class="balance-item ${data.balance.balance >= 0 ? 'positive' : 'negative'}">
                            <span>–ë–∞–ª–∞–Ω—Å:</span>
                            <span>${data.balance.balance >= 0 ? '+' : ''}${data.balance.balance?.toFixed(1) || '0.0'} –º–≥</span>
                        </div>
                    </div>
                </div>
                
                <div class="calc-section">
                    <h6>üìä –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                    <div class="current-stats">
                        <div class="stat-row">
                            <span>–í—Å–µ–≥–æ –ø—á–µ–ª:</span>
                            <span>${data.current_stats.total_bees}</span>
                        </div>
                        <div class="stat-row">
                            <span>–†–∞—Å–ø–ª–æ–¥:</span>
                            <span>${data.current_stats.total_brood}</span>
                        </div>
                        <div class="stat-row">
                            <span>–õ–µ—Ç–Ω—ã–µ –ø—á–µ–ª—ã:</span>
                            <span>${data.current_stats.flying_bees}</span>
                        </div>
                        <div class="stat-row">
                            <span>–ù–µ–ª–µ—Ç–Ω—ã–µ –ø—á–µ–ª—ã:</span>
                            <span>${data.current_stats.non_flying_bees}</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        calculationsContent.innerHTML = html;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤:', error);
        const calculationsContent = document.getElementById('calculations-content');
        if (calculationsContent) {
            calculationsContent.innerHTML = '<div class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤: ' + error.message + '</div>';
        }
    }
}
</script>

<style>
.hive-interface {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.hive-diagram {
    flex: 1;
    background: linear-gradient(135deg, #F5DEB3 0%, #DEB887 50%, #D2691E 100%);
    border-radius: 15px;
    margin-bottom: 20px;
    padding: 20px;
    position: relative;
    overflow: hidden;
}

.hive-cross-section {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.hive-body-3d {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: rgba(139, 69, 19, 0.1);
    border: 3px solid #8B4513;
    border-radius: 10px;
    padding: 20px;
    max-width: 600px;
}

.hive-section {
    background: rgba(255, 255, 255, 0.3);
    border: 2px solid #D2691E;
    border-radius: 8px;
    padding: 10px;
    position: relative;
}

.section-label {
    position: absolute;
    top: -12px;
    left: 10px;
    background: #8B4513;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.frames-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 5px;
    margin-top: 10px;
}

.frame-slot {
    aspect-ratio: 1;
    border: 2px solid #8B4513;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.frame-slot:hover {
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.frame-visual {
    width: 80%;
    height: 80%;
    border-radius: 3px;
    transition: all 0.3s ease;
}

.hive-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.inspection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.frame-inspection {
    background: rgba(255,255,255,0.6);
    border: 2px solid #D2691E;
    border-radius: 8px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.frame-inspection:hover {
    background: rgba(255,255,255,0.8);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.frame-number {
    font-weight: bold;
    color: #8B4513;
    margin-bottom: 5px;
}

.frame-type {
    font-size: 14px;
    color: #2F4F4F;
    margin-bottom: 5px;
}

.frame-cells {
    font-size: 12px;
    color: #666;
}

.bees-stats, .nectar-profile {
    margin: 20px 0;
}

.profile-info {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.profile-chart {
    background: rgba(255,255,255,0.5);
    border: 2px solid #D2691E;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
}

.feeding-form {
    max-width: 400px;
}

.feeding-info {
    background: rgba(255,255,255,0.5);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 15px;
    margin: 15px 0;
}

.frame-detail {
    margin: 20px 0;
}

.frame-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.frame-menu {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.nectar-info {
    background: rgba(255,255,255,0.5);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 15px;
    margin-top: 15px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ä–∞—Å—á–µ—Ç–æ–≤ */
.historical-chart {
    background: rgba(255,255,255,0.7);
    border: 2px solid #8B4513;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
}

.chart-container {
    position: relative;
    height: 250px;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
}

.detailed-calculations {
    background: rgba(255,255,255,0.7);
    border: 2px solid #8B4513;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
}

.calculations-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 15px;
}

.calc-section {
    background: rgba(255,255,255,0.5);
    border: 1px solid #D2691E;
    border-radius: 8px;
    padding: 15px;
}

.calc-section h6 {
    color: #8B4513;
    margin-bottom: 10px;
    font-size: 16px;
}

.formula-box {
    background: rgba(255,248,220,0.8);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 10px;
    margin: 10px 0;
}

.formula {
    font-family: 'Courier New', monospace;
    background: rgba(139, 69, 19, 0.1);
    padding: 5px;
    border-radius: 3px;
    margin: 5px 0;
    font-size: 14px;
}

.calculation {
    font-family: 'Courier New', monospace;
    background: rgba(218, 165, 32, 0.2);
    padding: 5px;
    border-radius: 3px;
    margin: 5px 0;
    font-size: 14px;
}

.result {
    background: rgba(34, 139, 34, 0.2);
    border: 1px solid #228B22;
    border-radius: 5px;
    padding: 8px;
    margin-top: 10px;
    text-align: center;
}

.balance-box {
    background: rgba(255,248,220,0.8);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 10px;
}

.balance-item {
    display: flex;
    justify-content: space-between;
    margin: 5px 0;
    padding: 5px;
    border-bottom: 1px solid rgba(139, 69, 19, 0.2);
}

.balance-item:last-child {
    border-bottom: none;
}

.balance-item.positive {
    background: rgba(34, 139, 34, 0.1);
    color: #228B22;
}

.balance-item.negative {
    background: rgba(255, 69, 0, 0.1);
    color: #FF4500;
}

.current-stats {
    background: rgba(255,248,220,0.8);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 10px;
}

.stat-row {
    display: flex;
    justify-content: space-between;
    margin: 5px 0;
    padding: 5px;
    border-bottom: 1px solid rgba(139, 69, 19, 0.2);
}

.stat-row:last-child {
    border-bottom: none;
}

.loading-message {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 20px;
}

.error-message {
    background: rgba(255, 69, 0, 0.1);
    border: 1px solid #FF4500;
    border-radius: 5px;
    padding: 10px;
    color: #FF4500;
    text-align: center;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    .calculations-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .chart-container {
        height: 250px;
    }
    
    .calc-section {
        padding: 10px;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ö–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–º–∫–∏ —Å —Å–æ—Ç–∞–º–∏ */
.frame-visualization {
    margin: 20px 0;
    text-align: center;
}

.frame-cells-grid {
    display: inline-block;
    background: rgba(255, 248, 220, 0.8);
    border: 3px solid #8B4513;
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    max-width: 100%;
    overflow-x: auto;
}

.cells-row {
    display: flex;
    justify-content: center;
    margin: 2px 0;
}

.frame-cell {
    width: 20px;
    height: 20px;
    margin: 1px;
    border: 1px solid #8B4513;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    /* clip-path —Å–æ–∑–¥–∞–µ—Ç —à–µ—Å—Ç–∏—É–≥–æ–ª—å–Ω—É—é —Ñ–æ—Ä–º—É */
}

.frame-cell:hover {
    transform: scale(1.2);
    z-index: 10;
    box-shadow: 0 0 10px rgba(139, 69, 19, 0.5);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —è—á–µ–µ–∫ */
.empty-cell {
    background: #F5DEB3;
    border-color: #D2691E;
}

.open-brood-cell {
    background: linear-gradient(135deg, #FFF8DC 0%, #F0E68C 100%);
    border-color: #B8860B;
    position: relative;
}

.open-brood-cell::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: #8B4513;
    border-radius: 50%;
    /* –ò–º–∏—Ç–∞—Ü–∏—è —è–π—Ü–∞ –∏–ª–∏ –ª–∏—á–∏–Ω–∫–∏ */
}

.closed-brood-cell {
    background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
    border-color: #654321;
    position: relative;
}

.closed-brood-cell::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 6px;
    background: #2F4F4F;
    border-radius: 50%;
    /* –ò–º–∏—Ç–∞—Ü–∏—è –∫—É–∫–æ–ª–∫–∏ */
}

.honey-cell {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    border-color: #DAA520;
    position: relative;
}

.honey-cell::before {
    content: '';
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 8px;
    background: rgba(139, 69, 19, 0.3);
    border-radius: 50%;
    /* –ò–º–∏—Ç–∞—Ü–∏—è –∫–∞–ø–ª–∏ –º–µ–¥–∞ */
}

.empty-space {
    width: 20px;
    height: 20px;
    margin: 1px;
    background: transparent;
    border: 1px dashed rgba(139, 69, 19, 0.3);
    opacity: 0.3;
}

/* –õ–µ–≥–µ–Ω–¥–∞ */
.legend {
    background: rgba(255, 255, 255, 0.7);
    border: 2px solid #8B4513;
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    text-align: left;
}

.legend h6 {
    color: #8B4513;
    margin-bottom: 10px;
    text-align: center;
}

.legend-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px;
}

.legend-cell {
    width: 16px;
    height: 16px;
    border: 1px solid #8B4513;
    clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
}

.legend-cell.empty-cell {
    background: #F5DEB3;
}

.legend-cell.open-brood-cell {
    background: linear-gradient(135deg, #FFF8DC 0%, #F0E68C 100%);
}

.legend-cell.closed-brood-cell {
    background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
}

.legend-cell.honey-cell {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞–º–∫–∏ */
.frame-stats {
    background: rgba(255, 248, 220, 0.8);
    border: 2px solid #8B4513;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.frame-stats h5 {
    color: #8B4513;
    margin-bottom: 15px;
    text-align: center;
    border-bottom: 2px solid #D2691E;
    padding-bottom: 5px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
    margin-bottom: 15px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 8px;
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid #D2691E;
    border-radius: 5px;
}

.stat-label {
    font-weight: bold;
    color: #2F4F4F;
}

.stat-value {
    color: #8B4513;
    font-weight: bold;
}

.brood-distribution {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 10px;
}

.brood-distribution h6 {
    color: #8B4513;
    margin-bottom: 8px;
}

.age-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 8px;
}

.age-item {
    display: flex;
    justify-content: space-between;
    padding: 5px;
    background: rgba(255, 248, 220, 0.5);
    border-radius: 3px;
}

.age-label {
    font-size: 12px;
    color: #2F4F4F;
}

.age-value {
    font-weight: bold;
    color: #8B4513;
}

.honey-info {
    background: rgba(255, 248, 220, 0.5);
    border: 1px solid #D2691E;
    border-radius: 5px;
    padding: 10px;
    text-align: center;
}

.honey-info h6 {
    color: #8B4513;
    margin-bottom: 5px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
    .frame-cells-grid {
        padding: 10px;
        max-width: 100%;
    }
    
    .frame-cell {
        width: 16px;
        height: 16px;
        margin: 0.5px;
    }
    
    .empty-space {
        width: 16px;
        height: 16px;
        margin: 0.5px;
    }
    
    .legend-items {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .age-stats {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}